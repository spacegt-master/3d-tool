<template>
    <div class="p-6 h-full flex flex-col justify-between">
        <h2 class="text-2xl font-bold mb-6 text-gray-700">ç³»ç»Ÿæ¨ç†ä¸å…¨å±€ç»‘å®š (æ­¥éª¤ 4)</h2>

        <div class="flex-grow overflow-y-auto">
            <v-alert type="success" icon="mdi-check-decagram" density="compact" class="mb-6" variant="tonal">
                å˜é‡ **{{ variable.name }}** å®šä¹‰æˆåŠŸã€‚ç³»ç»Ÿå·²æ‰§è¡Œ **å…¨å±€å°ºå¯¸åŒ¹é…**ã€‚
            </v-alert>

            <!-- å˜é‡å®šä¹‰æ¦‚è§ˆ -->
            <v-card class="mb-6" variant="outlined">
                <v-card-title class="text-h6 font-weight-medium text-blue-grey-darken-2">
                    <v-icon icon="mdi-ruler-square" class="mr-2" color="blue-grey"></v-icon>
                    å˜é‡è¯¦æƒ…
                </v-card-title>
                <v-card-text>
                    <v-row dense>
                        <v-col cols="12" md="6">
                            <v-list-item density="compact">
                                <v-list-item-title class="font-weight-bold">ç›®æ ‡å˜é‡å</v-list-item-title>
                                <v-list-item-subtitle class="text-pink-600 font-weight-bold">{{ variable.name
                                    }}</v-list-item-subtitle>
                            </v-list-item>
                        </v-col>
                        <v-col cols="12" md="6">
                            <v-list-item density="compact">
                                <v-list-item-title class="font-weight-bold">ç›®æ ‡å€¼/è¡¨è¾¾å¼</v-list-item-title>
                                <v-list-item-subtitle class="text-green-600 font-weight-bold">{{ variable.value
                                    }}</v-list-item-subtitle>
                            </v-list-item>
                        </v-col>
                        <v-col cols="12" md="6">
                            <v-list-item density="compact">
                                <v-list-item-title class="font-weight-bold">åŸå§‹åŸºå‡† Mesh åç§°</v-list-item-title>
                                <!-- ğŸŒŸ æ›´æ”¹ä¸ºæ˜¾ç¤º Mesh Name -->
                                <v-list-item-subtitle class="font-weight-bold text-blue-600">{{ variable.sourceMeshName
                                    || 'N/A' }}</v-list-item-subtitle>
                            </v-list-item>
                        </v-col>
                        <v-col cols="12" md="6">
                            <v-list-item density="compact">
                                <v-list-item-title class="font-weight-bold">åŸºå‡†å°ºå¯¸</v-list-item-title>
                                <v-list-item-subtitle>{{ variable.initialValue.toFixed(3) }} ({{
                                    variable.axis.toUpperCase() }}è½´)</v-list-item-subtitle>
                            </v-list-item>
                        </v-col>
                    </v-row>
                </v-card-text>
            </v-card>

            <!-- ğŸŒŸ æ ¸å¿ƒï¼šå…¨å±€åŒ¹é…ä¸ç»‘å®šç»“æœ -->
            <v-card variant="tonal" class="border-green-400 border-2">
                <v-card-title class="text-h6 font-weight-medium text-green-700">
                    <v-icon icon="mdi-link-variant" class="mr-2" color="green-700"></v-icon>
                    å…¨å±€åŒæ­¥ç»‘å®šç»“è®º
                </v-card-title>
                <v-card-text>
                    <!-- <p class="text-lg mb-3">
                        ç³»ç»Ÿåœ¨åœºæ™¯ä¸­åŒ¹é…åˆ° **{{ variable.bindings.length }}** ä¸ªæ‹¥æœ‰ç›¸åŒå°ºå¯¸ï¼ˆ{{ variable.sourceInitialValue.toFixed(3)
                        }}mï¼‰çš„è¾¹ã€‚
                    </p>

                    <v-alert :type="variable.bindings.length > 1 ? 'info' : 'warning'" density="compact" variant="tonal"
                        class="mb-4">
                        <span v-if="variable.bindings.length > 1">
                            è¿™äº› Mesh çš„å¯¹åº”è½´å‘å·²è¢« **{{ variable.name }}** å˜é‡é”å®šï¼Œå®ç°ä¸€æ”¹å…¨æ”¹ã€‚
                        </span>
                        <span v-else>
                            ä»…åŒ¹é…åˆ°æº Meshï¼Œè¯·ç¡®è®¤å…¶ä»– Mesh å°ºå¯¸æ˜¯å¦ä¸€è‡´æˆ–æ‰‹åŠ¨æ·»åŠ ç»‘å®šã€‚
                        </span>
                    </v-alert>

                    <v-expansion-panels flat>
                        <v-expansion-panel title="æŸ¥çœ‹ç»‘å®šåˆ—è¡¨ (Mesh åç§°)" :text="variable.bindings.map(b =>
                            // ğŸŒŸ æ›´æ”¹ä¸ºæ˜¾ç¤º Mesh Name
                            `- Mesh Name: ${b.meshName} (${b.axis.toUpperCase()} è½´, åˆå§‹å€¼: ${b.initialValue.toFixed(3)}m)`
                        ).join('\n')">
                        </v-expansion-panel>
                    </v-expansion-panels> -->
                </v-card-text>
            </v-card>
        </div>

        <!-- å®Œæˆæ“ä½œ -->
        <v-btn color="success" @click="$emit('close-dialog')" class="mt-8" size="large" width="100%">
            å®Œæˆè‡ªå®šä¹‰å˜é‡è®¾ç½®å¹¶æ¿€æ´»çº¦æŸ
        </v-btn>
    </div>
</template>

<script setup lang="ts">
import type { Mesh } from 'three';
// ğŸŒŸ å¼•å…¥ VariableBinding ç±»å‹ï¼Œç”¨äºæ„é€  CustomVariable æ¥å£
import { type VariableBinding } from '@/stores/variableStore';
import type { SideData } from '@/types/mesh';

// å®šä¹‰ Variable çš„ç±»å‹ï¼ŒåŸºäº variableStore.ts çš„æœ€æ–°ç»“æ„
export interface CustomVariable {
    name: string;
    value: string;
    sourceMeshName: string;
    sourceAxis: SideData['axis'];
    sourceInitialValue: number;
    description: string;
    bindings: VariableBinding[];
}

const props = defineProps<{
    mesh: Mesh | undefined, // Mesh å¯¹è±¡ï¼Œç”¨äºæ˜¾ç¤ºå…¶ UUID
    variable: CustomVariable // æ­¥éª¤ 3 å®šä¹‰çš„å˜é‡ç»“æœ
}>();

// å®šä¹‰ä¸€ä¸ª emitï¼Œç”¨äºé€šçŸ¥çˆ¶ç»„ä»¶å…³é—­å¯¹è¯æ¡†
defineEmits(['close-dialog']);

</script>

<style scoped>
/* ç¡®ä¿ç»„ä»¶å……æ»¡å®¹å™¨å¹¶ä½¿ç”¨ flex å¸ƒå±€ */
.p-6 {
    padding: 1.5rem;
}
</style>
